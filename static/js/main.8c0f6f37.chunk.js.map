{"version":3,"sources":["../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/shared.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/usePersist.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useGameState.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/stores.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/funcs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/usePeer.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useConnections.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useMoves.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useSendSyncs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/usePartyHost.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/funcs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useAck.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useSync.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useMoves.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useConnection.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/usePartyGuest.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/stores.js","../../compendium/tic-tac-toe/game/index.js","../../.yarn/$$virtual/@compendium-tic-tac-toe-host-virtual-bdcd2cbf8d/1/compendium/tic-tac-toe/host/dist/index.js","../../compendium/tic-tac-toe/guest/dist/index.js","compendium.js","../../.yarn/$$virtual/@compendium-tic-tac-toe-virtual-8c2105eed3/1/compendium/tic-tac-toe/index.js","rooms.js","Home.js","Router.js","App.js","reportWebVitals.js","index.js","../../.yarn/cache/peerjs-npm-1.3.1-878534ae62-2dc03823ec.zip/node_modules/peerjs/dist sync"],"names":["getMoves","connectionId","roomId","game","hostMoves","guestMoves","constructReducer","events","state","reduce","o","event","move","getMoveFunction","moveFn","args","e","console","error","constructMoves","handleMove","Proxy","get","target","key","receiver","moves","hasOwnProperty","Symbol","iterator","keys","bind","Reflect","usePersist","store","defaultValue","useState","JSON","parse","getItem","Function","setState","item","window","localStorage","useEffect","setItem","stringify","useGameState","eventLog","logSize","useRef","useStateStore","slice","current","length","updateState","logEvent","setEventLog","destructPeer","setPeer","peer","destroy","opts","host","secure","usePeer","id","open","setOpen","useReducer","a","attempts","countAttempt","Peer","retry","timeout","setTimeout","on","clearTimeout","onConnectionClosed","useConnections","connections","setConnections","connectionLogSizeMap","conn","conns","appendConnection","index","isInteger","size","updateLogSizeMap","validMoves","isString","isObject","findIndex","m","validateEvent","Object","filter","c","removeConnection","useMoves","setMoves","constructMovesHandler","useSendSyncs","connection","numSent","map","i","send","usePartyHost","useEventLogStore","connectionIds","useMemo","logSizeToIndex","useAck","connected","ack","useSync","data","clearData","setLogSize","updateLogSize","setCache","reducer","newState","cache","sync","preempt","emit","useConnection","setData","setConnected","connect","stream","usePartyGuest","uuid","useIdStore","useLogSizeStore","TicTacToe","fillSquare","player","crossesPlayer","noughtsPlayer","Error","board","position","splice","startGame","crossesConnId","noughtsConnId","Array","fill","Tile","styled","div","Board","Host","React","createElement","Fragment","Link","to","location","value","Button","button","TileOrButton","onClick","compendium","name","Guest","permutations","useConnectionId","setConnectionId","randomWords","exactly","join","getGame","compendiumIndex","words","split","sortedWords","sort","permutation","word","w","permu","isEqual","decodeCompendiumIndex","useGame","setGame","NewGame","onNewGame","set","onSubmit","onChange","preventDefault","onKeyPress","JoinGame","onJoinGame","Home","push","useHistory","order","createRoomId","HostRoute","useParams","GuestRoute","Router","path","exact","App","reportWebVitals","onPerfEntry","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","webpackEmptyContext","req","code","resolve","module","exports"],"mappings":"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","file":"static/js/main.8c0f6f37.chunk.js","sourcesContent":["const getMoves = ({ connectionId, roomId, game }) => (\n  connectionId === roomId ? game.hostMoves : game.guestMoves\n);\n\nconst getMoveFunction = ({ connectionId, roomId, game, move }) => (\n  getMoves({ connectionId, roomId, game })[move]\n)\n\nexport const constructReducer = ({ game, events, roomId }) => (state) => {\n  try {\n    return events.reduce(\n      (o, event) => {\n        const moveFn = getMoveFunction({ connectionId: event.connectionId, roomId, game, move: event.move })\n        return moveFn({ state: o, connectionId: event.connectionId, args: event.args });\n      },\n      state\n    );\n  } catch (e) {\n    console.error(e);\n    return state;\n  }\n}\n\nexport const constructMoves = ({ game, connectionId, roomId, handleMove }) => {\n  return new Proxy({}, {\n    get: (target, key, receiver) => {\n      const moves = getMoves({ connectionId, roomId, game });\n      if (moves.hasOwnProperty(key)) {\n        return (args) => handleMove({ move: key, args });\n      } else if (key === Symbol.iterator && moves) {\n        return moves.keys().bind(target)[Symbol.iterator]\n      } else {\n        return Reflect.get(target, key, receiver);\n      }\n    }\n  });\n}\n","import { useState, useEffect } from \"react\";\n\nconst usePersist = (store, key, defaultValue) => {\n  const [state, setState] = useState(\n    () => (\n      JSON.parse(store.getItem(key)) || \n      ((defaultValue instanceof Function) ? defaultValue() : defaultValue)\n    )\n  );\n\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : defaultValue;\n    } catch (error) {\n      console.error(error);\n      return defaultValue;\n    }\n  });\n\n  useEffect(() => {\n    store.setItem(key, JSON.stringify(state));\n  }, [key, state]);\n\n  return [state, setState];\n}\n\nexport default usePersist;\n","import { useRef, useEffect } from \"react\";\nimport { useStateStore } from \"./stores\";\nimport { constructReducer } from \"../shared\";\n\nconst updateState = ({ roomId, setState, game, events }) => {\n  const reducer = constructReducer({ game, roomId, events })\n  setState(reducer);\n}\n\nconst useGameState = ({ roomId, game, eventLog }) => {\n  const logSize = useRef();\n  const { state, setState } = useStateStore(roomId);\n  useEffect(() => {\n    const events = eventLog.slice(logSize.current || 0);\n    if (!roomId || !game || !events.length) return;\n    updateState({ roomId, setState, game, events });\n    logSize.current = eventLog.length;\n  }, [setState, roomId, game, eventLog, logSize])\n  return { state };\n}\n\nexport default useGameState\n","import usePersist from '../usePersist';\n\nexport const useStateStore = (roomId) => {\n  const [state, setState]  = usePersist(\n    window.localStorage,\n    `hostState-${roomId}`,\n    {}\n  );\n  return { state, setState }\n}\n\nexport const useEventLogStore = (roomId) => {\n  const [eventLog, setEventLog] = usePersist(\n    window.localStorage,\n    `eventLog-${roomId}`,\n    []\n  );\n  return { eventLog, setEventLog };\n}\n","export const logEvent = ({ setEventLog, event, connectionId }) => {\n  setEventLog(events => [...events, { ...event, connectionId }]);\n}\n\n","import { useEffect, useRef, useState, useReducer } from \"react\";\nimport Peer from \"peerjs\";\n\nconst destructPeer = ({ setPeer }) => {\n  setPeer(peer => {\n    peer && peer.destroy();\n    return null\n  })\n};\n\nconst opts = { host: \"peerjs.92k.de\", secure: true };\n\nconst usePeer = (id) => {\n  const [peer, setPeer] = useState();\n  const [open, setOpen] = useState(false);\n  const [attempts, countAttempt] = useReducer(a => a + 1, 0);\n\n  useEffect(() => {\n    if (open) return;\n\n    const peer = new Peer(id, opts);\n    setPeer(peer);\n\n    const retry = () => {\n      setOpen(false);\n      destructPeer({ setPeer });\n      countAttempt();\n    };\n\n    let timeout = setTimeout(retry, 1000);\n\n    peer.on(\"open\", () => {\n      clearTimeout(timeout);\n      setOpen(true);\n    });\n\n    const onConnectionClosed = () => {\n      clearTimeout(timeout);\n      timeout = setTimeout(retry, 1000);\n    }\n    peer.on(\"close\", onConnectionClosed);\n    peer.on(\"disconnected\", onConnectionClosed);\n    peer.on(\"error\", onConnectionClosed);\n\n    return () => {\n      destructPeer({ setPeer });\n      clearTimeout(timeout);\n    }\n  }, [attempts, id])\n\n  return { open, peer }\n}\n\nexport default usePeer;\n","import { useRef, useState, useEffect, useMemo } from \"react\";\nimport { isString, isObject, isInteger } from \"lodash\";\nimport { logEvent } from \"./funcs\";\nimport usePeer from \"../usePeer\";\n\nconst validateEvent = (event, validMoves) => (\n  event &&\n  isString(event.move) && \n  isObject(event.args) &&\n  validMoves.findIndex((m) => m === event.move) > -1\n)\n\nconst appendConnection = ({ setConnections, conn }) => {\n  setConnections((conns) => [...conns, conn]);\n}\n\nconst removeConnection = ({ setConnections, conn }) => {\n  setConnections((conns) => conns.filter(c => c !== conn))\n}\n\nconst updateLogSizeMap = ({ conn, connectionLogSizeMap, size = 0 }) => {\n  connectionLogSizeMap.current[conn.peer] = size\n}\n\nconst useConnections = ({ game, roomId, eventLog, setEventLog }) => {\n  const { peer } = usePeer(roomId);\n  const [connections, setConnections] = useState([]);\n  const connectionLogSizeMap = useRef({});\n\n  useEffect(() => {\n    if (!peer) return;\n    peer.on(\"connection\", (conn) => {\n      conn.on(\"open\", () => {\n        appendConnection({ setConnections, conn });\n      });\n\n      conn.on(\"data\", ({ index, ...event }) => {\n        if (isInteger(index)) {\n          updateLogSizeMap({ conn, connectionLogSizeMap, size: index + 1 });\n        }\n        \n        if (\n          (isInteger(index) || index === null) &&\n          validateEvent(event, Object.keys(game.guestMoves))\n        ) {\n          logEvent({ setEventLog, event, connectionId: conn.peer });\n        }\n      })\n\n      conn.on(\"close\", () => {\n        removeConnection({ setConnections, conn });\n      });\n\n      conn.on(\"error\", (error) => {\n        console.error(conn.peer, error)\n      });\n    })\n\n  }, [peer, game, roomId])\n\n  return { connections, connectionLogSizeMap }\n}\n\nexport default useConnections;\n","import { useEffect, useState } from \"react\";\nimport { constructMoves } from \"../shared\";\nimport { logEvent } from \"./funcs\";\n\nconst constructMovesHandler = ({ setMoves, game, roomId, setEventLog }) => {\n  const handleMove = ({ move, args }) => {\n    logEvent({ setEventLog, event: { move, args }, connectionId: roomId })\n  };\n  setMoves(() => constructMoves({ game, connectionId: roomId, roomId, handleMove }))\n}\n\nconst useMoves = ({ roomId, game, setEventLog }) => {\n  const [moves, setMoves] = useState(null);\n\n  useEffect(() => {\n    if (!game) return;\n    constructMovesHandler({ setMoves, game, roomId, setEventLog });\n  }, [roomId, game, setEventLog]);\n\n  return { moves, setMoves }\n}\n\nexport default useMoves;\n","import { useEffect } from \"react\";\n\nconst useSendSyncs = ({ connections, connectionLogSizeMap, eventLog }) => {\n  useEffect(() => {\n    for (const connection of connections) {\n      const numSent = connectionLogSizeMap.current[connection.peer] || 0;\n      if (eventLog.length > numSent) {\n        const events = eventLog.slice(numSent)\n          .map((e, i) => ({ ...e, index: numSent + i }));\n        connection.send(events);\n      }\n    }\n  }, [connections, connectionLogSizeMap, eventLog]);\n};\n\nexport default useSendSyncs;\n","import { useRef, useState, useEffect, useMemo } from \"react\";\nimport { constructMoves, constructReducer } from \"../shared\";\nimport { useStateStore, useEventLogStore } from \"./stores\";\nimport useGameState from \"./useGameState\";\nimport useConnections from \"./useConnections\";\nimport useMoves from \"./useMoves\";\nimport useSendSyncs from \"./useSendSyncs\";\n\n\nconst usePartyHost = ({ roomId, game }) => {\n  const { eventLog, setEventLog } = useEventLogStore(roomId);\n  const { state } = useGameState({ roomId, game, eventLog });\n  const { connections, connectionLogSizeMap } = useConnections({ game, roomId, eventLog, setEventLog })\n  const connectionIds = useMemo(() => connections.map(({ peer }) => peer), [connections])\n  const { moves } = useMoves({ roomId, game, setEventLog });\n  useSendSyncs({ connections, connectionLogSizeMap, eventLog });\n  return { state, moves, connections: connectionIds }\n}\n\nexport default usePartyHost;\n","export const logSizeToIndex = logSize => {\n  const index = logSize - 1;\n  return (index < 0) ? null : index;\n};\n","import { useEffect } from \"react\";\nimport { logSizeToIndex } from \"./funcs\";\n\nexport const ack = ({ conn, logSize }) => {\n  conn.current.send({ index: logSizeToIndex(logSize) })\n}\n\nconst useAck = ({ connected, conn, logSize }) => {\n  useEffect(() => {\n    if (!conn.current || !connected) return;\n    ack({ conn, logSize })\n  }, [connected, conn.current, logSize]);\n}\n\nexport default useAck;\n","import { useEffect } from \"react\";\nimport { constructReducer } from \"../shared\";\n\nconst sync = ({ setState, setCache, roomId, game, events }) => {\n  const reducer = constructReducer({ game, roomId, events })\n  setState(({ state }) => {\n    const newState = reducer(state);\n    return { state: newState, cache: newState }\n  });\n}\n\nconst updateLogSize = ({ setLogSize, events }) => {\n  setLogSize(events[events.length - 1].index + 1);\n}\n\nconst useSync = ({ data, clearData, game, roomId, setState, setLogSize }) => {\n  useEffect(() => {\n    if (!data || !data.length) return;\n    const events = [...data]\n    clearData();\n    updateLogSize({ setLogSize, events });\n    sync({ setState, roomId, game, events })\n  }, [data, clearData, game, roomId, setLogSize, setState])\n}\n\nexport default useSync;\n","import { useEffect, useState } from \"react\";\nimport { constructMoves, constructReducer } from \"../shared\";\nimport { logSizeToIndex } from \"./funcs\";\n\nexport const emit = ({ conn, logSize, move, args }) => {\n  conn.current.send({ index: logSizeToIndex(logSize), move, args })\n}\n\nexport const preempt = ({ setState, game, move, args, connectionId, roomId }) => {\n  const reducer = constructReducer({ game, roomId, events: [{ move, args, connectionId }] })\n  setState(({ state, cache }) => ({\n    cache: reducer(state),\n    state,\n  }));\n}\n\nexport const constructMovesHandler = ({ conn, connectionId, setMoves, setState, game, logSize, roomId }) => {\n  const handleMove = ({ move, args }) => {\n    preempt({ setState, game, move, args, roomId, connectionId })\n    emit({ conn, move, args, logSize })\n  }\n  setMoves(() => constructMoves({ game, connectionId, roomId, handleMove }));\n}\n\nconst useMoves = ({ connected, conn, id, setState, roomId, game, logSize }) => {\n  const [moves, setMoves] = useState(null);\n  useEffect(() => {\n    if (!connected) return;\n    constructMovesHandler({ conn, connectionId: id, setMoves, setState, roomId, game, logSize })\n  }, [connected, conn.current, id, setMoves, setState, roomId, game, logSize])\n  return { moves };\n}\n\nexport default useMoves;\n","import { useEffect, useRef, useState, useReducer } from \"react\";\nimport usePeer from \"../usePeer\";\n\nexport const connect = ({ roomId, peer, conn }) => {\n  conn.current = peer.connect(roomId);\n}\n\nconst useConnection = ({ id, roomId }) => {\n  const conn = useRef();\n  const { open, peer } = usePeer(id);\n  const [data, setData] = useState([]);\n  const [connected, setConnected] = useState(false);\n  const [attempts, countAttempt] = useReducer(a => a + 1, 0);\n\n  useEffect(() => {\n    if (!open || connected) return;\n\n    connect({ conn, peer, roomId });\n\n    const retry = () => {\n      conn.current = null;\n      setConnected(false);\n      countAttempt();\n    }\n    const timeout = setTimeout(retry, 1000);\n\n    conn.current.on(\"open\", () => {\n      clearTimeout(timeout);\n      setConnected(true); \n    });\n\n    conn.current.on(\"data\", (data) => {\n      setData((stream) => [...stream, ...data]);\n    });\n\n    conn.current.on(\"close\", () => {\n      clearTimeout(timeout);\n      retry();\n    });\n\n    conn.current.on(\"error\", (error) => {\n      console.error(error)\n    });\n\n  }, [attempts, open, connected, roomId]);\n\n  const clearData = () => setData([]);\n  return { connected: open && connected, conn, data, clearData }\n}\n\nexport default useConnection;\n","import useAck from \"./useAck\";\nimport useSync from \"./useSync\";\nimport useMoves from \"./useMoves\";\nimport useConnection from \"./useConnection\";\nimport { useIdStore, useStateStore, useLogSizeStore } from \"./stores\";\n\nconst usePartyGuest = ({ roomId, game }) => {\n  const { id } = useIdStore(roomId);\n  const { cache, setState } = useStateStore(roomId);\n  const { logSize, setLogSize } = useLogSizeStore(roomId);\n  const { connected, conn, data, clearData } = useConnection({ id, roomId })\n  useAck({ connected, conn, logSize });\n  useSync({ data, clearData, game, roomId, setState, setLogSize });\n  const { moves } = useMoves({ connected, conn, id, setState, roomId, game, logSize });\n  return { connected, state: cache, moves }\n}\n\nexport default usePartyGuest;\n","import usePersist from \"../usePersist\";\nimport { v4 as uuid } from \"uuid\";\n\nexport const useIdStore = (roomId) => {\n  const [id] = usePersist(\n    window.localStorage,\n    `id-${roomId}`,\n    uuid,\n  );\n  return { id };\n}\n\nexport const useStateStore = (roomId) => {\n  const [{ cache }, setState] = usePersist(\n    window.localStorage,\n    `guestState-${roomId}`,\n    { state: {}, cache: {} }\n  );\n  return { cache, setState };\n}\n\nexport const useLogSizeStore = (roomId) => {\n  const [logSize, setLogSize] = usePersist(\n    window.localStorage,\n    `logSize-${roomId}`,\n    0\n  );\n  return { logSize, setLogSize };\n}\n","export const NOUGHTS = 1;\nexport const CROSSES = 2;\n\nconst startGame = ({ state, connectionId, args }) => ({\n  crossesPlayer: args.crossesConnId,\n  noughtsPlayer: args.noughtsConnId,\n  board: Array(9).fill(null),\n});\n\nconst fillSquare = ({ state, connectionId, args }) => {\n  let player = null\n  if (connectionId === state.crossesPlayer) {\n    player = CROSSES;\n  } else if (connectionId === state.noughtsPlayer) {\n    player = NOUGHTS;\n  } else {\n    throw new Error('Connection is not a player');\n  }\n\n  if (state.board[args.position] !== null) {\n    throw new Error('Position filled');\n  }\n\n  const board = [...state.board];\n  board.splice(args.position, 1, player);\n\n  return ({\n    ...state,\n    board,\n  })\n}\n\nconst TicTacToe = {\n  guestMoves: {\n    fillSquare,\n  },\n  \n  hostMoves: {\n    startGame,\n  },\n}\n\nexport default TicTacToe;\n","import React, { useEffect } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { NOUGHTS, CROSSES } from \"@compendium/tic-tac-toe-game\";\nconst Tile = styled.div`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: cyan;\n  border: 2px solid yellow;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Board = styled.div`\n  width: 30em;\n  height: 30em;\n`;\n\nconst Host = ({\n  state,\n  roomId,\n  moves,\n  connections\n}) => {\n  useEffect(() => {\n    if (!state.board && connections.length >= 2) {\n      const [crossesConnId, noughtsConnId] = connections;\n      moves.startGame({\n        crossesConnId,\n        noughtsConnId\n      });\n    }\n  }, [connections]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, connections.length < 2 && /*#__PURE__*/React.createElement(Link, {\n    to: `/guest/${roomId}`\n  }, window.location.host, \"#/guest/\", roomId), /*#__PURE__*/React.createElement(Board, null, state.board && state.board.map((value, position) => /*#__PURE__*/React.createElement(Tile, {\n    key: position\n  }, value === NOUGHTS ? \"O\" : null, value === CROSSES ? \"X\" : null))));\n};\n\nexport default Host;","import React from \"react\";\nimport styled from \"styled-components\";\nimport { NOUGHTS, CROSSES } from \"@compendium/tic-tac-toe-game\";\nconst Button = styled.button`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Tile = styled.div`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Board = styled.div`\n  width: 30em;\n  height: 30em;\n`;\n\nconst TileOrButton = ({\n  value,\n  onClick\n}) => value === null ? /*#__PURE__*/React.createElement(Button, {\n  onClick: onClick\n}) : /*#__PURE__*/React.createElement(Tile, null, value === NOUGHTS ? \"O\" : null, value === CROSSES ? \"X\" : null);\n\nconst Guest = ({\n  connected,\n  state,\n  moves\n}) => /*#__PURE__*/React.createElement(React.Fragment, null, connected ? null : /*#__PURE__*/React.createElement(\"p\", null, \"Disconnected..\"), /*#__PURE__*/React.createElement(Board, null, state.board && state.board.map((value, position) => /*#__PURE__*/React.createElement(TileOrButton, {\n  key: position,\n  value: value,\n  onClick: () => connected && moves.fillSquare({\n    position\n  })\n}))));\n\nexport default Guest;","import TicTacToe from \"@compendium/tic-tac-toe\";\n\nconst compendium = [\n  TicTacToe,\n];\n\nexport default compendium;\n","import game from \"@compendium/tic-tac-toe-game\";\nimport Host from \"@compendium/tic-tac-toe-host\";\nimport Guest from \"@compendium/tic-tac-toe-guest\";\n\nconst name = \"Tic Tac Toe\";\n\nconst TicTacToe = { name, Host, Guest, game };\n\nexport default TicTacToe;\n","import { useState, useEffect } from \"react\";\nimport compendium from \"./compendium\";\nimport randomWords from \"random-words\";\nimport isEqual from \"lodash/isEqual\";\n\nconst permutations = [\n  [0, 1, 2],\n  [0, 2, 1],\n  [1, 0, 2],\n  [2, 0, 1],\n  [2, 1, 0],\n  [1, 2, 0],\n];\n\nconst createConnectionId = () => randomWords({ exactly: 5 }).join('-');\n\nexport const useConnectionId = () => {\n  const [connectionId, setConnectionId] = useState();\n  useEffect(() => {\n    setConnectionId(() => createConnectionId())\n  }, []);\n  return connectionId;\n}\n\nexport const createRoomId = (compendiumIndex) => {\n  const order = permutations[compendiumIndex]\n  const words = randomWords({ exactly: 3 })\n  const sortedWords = words.sort()\n  const orderedWords = order.map(o => sortedWords[o])\n  const roomId = orderedWords.join('-')\n  return roomId\n}\n\nconst decodeCompendiumIndex = (roomId) => {\n  const words = roomId.split('-')\n  const sortedWords = words.sort()\n  const permutation = words.map(word => sortedWords.findIndex((w) => word === w))\n  const compendiumIndex = permutations.findIndex((permu) => isEqual(permu, permutation))\n  return compendiumIndex;\n}\n\nconst getGame = (roomId) => {\n  const compendiumIndex = decodeCompendiumIndex(roomId)\n  const game = compendium[compendiumIndex];\n  return game;\n}\n\nexport const useGame = (roomId) => {\n  const [game, setGame] = useState({ name: null, Host: null, Guest: null, game: null });\n  useEffect(() => setGame(getGame(roomId)), [])\n  return game;\n}\n","import { useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { createRoomId } from \"./rooms\";\nimport compendium from \"./compendium\";\n\nconst NewGame = ({ onNewGame }) => {\n  const [value, set] = useState(0);\n\n  const onChange = (e) => {\n    set(e.target.value);\n    e.preventDefault();\n  }\n\n  const onSubmit = () => onNewGame(value);\n\n  return (\n    <>\n      <select onChange={onChange} value={value}>\n        {compendium.map(({ name }, index) =>\n          <option value={index} key={index}>{name}</option>)}\n      </select>\n      <button onClick={onSubmit} onKeyPress={onSubmit}>Host New Game</button>\n    </>\n  )\n}\n\nconst JoinGame = ({ onJoinGame }) => {\n  const [value, set] = useState();\n\n  const onChange = (e) => {\n    set(e.target.value);\n    e.preventDefault();\n  }\n\n  const onSubmit = () => onJoinGame(value);\n\n  return (\n    <>\n      <label>\n        Room Password\n        <input onChange={onChange} value={value}/>\n      </label>\n      <button onClick={onSubmit} onKeyPress={onSubmit}>Join Game</button>\n    </>\n  );\n}\n\n\nconst Home = () => {\n  const { push } = useHistory();\n\n  const onNewGame = (compendiumIndex) => {\n    const roomId = createRoomId(compendiumIndex);\n    push(`/host/${roomId}`)\n  }\n\n  const onJoinGame = (roomId) => {\n    push(`/guest/${roomId}`)\n  }\n\n  return (\n    <>\n      <NewGame onNewGame={onNewGame} />\n      <JoinGame onJoinGame={onJoinGame} />\n    </>\n  )\n}\n\n\nexport default Home;\n","import { usePartyHost, usePartyGuest } from \"@compendium/peer-party\";\nimport { HashRouter, Switch, Route, useParams } from \"react-router-dom\";\nimport { useGame, useConnectionId } from \"./rooms\";\nimport Home from \"./Home\";\n\nconst HostRoute = () => {\n  const { roomId } = useParams();\n  const { Host, game } = useGame(roomId);\n  const { state, moves, connections } = usePartyHost({ roomId, game });\n  return (\n    Host && <Host roomId={roomId} state={state} moves={moves} connections={connections} />\n  )\n}\n\nconst GuestRoute = () => {\n  const id = useConnectionId();\n  const { roomId } = useParams();\n  const { Guest, game } = useGame(roomId);\n  const { connected, state, moves } = usePartyGuest({ id, roomId, game });\n  return (\n    Guest && <Guest connectionId={id} roomId={roomId} connected={connected} state={state} moves={moves}/>\n  )\n}\n\nconst Router = () =>\n  <HashRouter>\n    <Switch>\n      <Route path=\"/host/:roomId\">\n        <HostRoute/>\n      </Route>\n      <Route path=\"/guest/:roomId\">\n        <GuestRoute/>\n      </Route>\n      <Route exact path=\"/\">\n        <Home/>\n      </Route>\n    </Switch>\n  </HashRouter>\n\nexport default Router;\n","import Router from \"./Router\";\n\nconst App = () =>\n  <Router/>\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 62;"],"sourceRoot":""}