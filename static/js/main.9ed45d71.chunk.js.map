{"version":3,"sources":["../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/shared.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/usePersist.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useGameState.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/stores.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/funcs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/usePeer.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useConnections.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useMoves.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/useSendSyncs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/host/usePartyHost.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/funcs.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useAck.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useSync.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useMoves.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/useConnection.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/usePartyGuest.js","../../.yarn/$$virtual/@compendium-peer-party-virtual-192a67fece/1/peer-party/src/guest/stores.js","../../compendium/tic-tac-toe/game/index.js","../../.yarn/$$virtual/@compendium-tic-tac-toe-host-virtual-71c87b8164/1/compendium/tic-tac-toe/host/dist/index.js","../../compendium/tic-tac-toe/guest/dist/index.js","../../.yarn/$$virtual/@compendium-compendium-virtual-cdf21b27b6/1/compendium/index.js","../../.yarn/$$virtual/@compendium-tic-tac-toe-virtual-e7044e863d/1/compendium/tic-tac-toe/index.js","rooms.js","Home.js","Router.js","App.js","reportWebVitals.js","index.js","../../.yarn/cache/peerjs-npm-1.3.1-878534ae62-2dc03823ec.zip/node_modules/peerjs/dist sync"],"names":["getMoves","connectionId","roomId","game","hostMoves","guestMoves","constructReducer","events","state","reduce","o","event","move","getMoveFunction","moveFn","args","e","console","error","constructMoves","handleMove","Proxy","get","target","key","receiver","moves","hasOwnProperty","Symbol","iterator","keys","bind","Reflect","usePersist","store","defaultValue","useState","JSON","parse","getItem","Function","setState","item","window","localStorage","useEffect","setItem","stringify","useGameState","eventLog","logSize","useRef","useStateStore","slice","current","length","updateState","logEvent","setEventLog","destructPeer","setPeer","peer","destroy","usePeer","id","open","setOpen","useReducer","a","attempts","countAttempt","Peer","retry","timeout","setTimeout","on","clearTimeout","onConnectionClosed","useConnections","connections","setConnections","connectionLogSizeMap","conn","conns","appendConnection","index","isInteger","size","updateLogSizeMap","validMoves","isString","isObject","findIndex","m","validateEvent","Object","filter","c","removeConnection","useMoves","setMoves","constructMovesHandler","useSendSyncs","connection","numSent","map","i","send","usePartyHost","useEventLogStore","connectionIds","useMemo","logSizeToIndex","useAck","connected","ack","useSync","data","clearData","setLogSize","updateLogSize","setCache","reducer","newState","cache","sync","preempt","emit","useConnection","setData","setConnected","connect","stream","usePartyGuest","uuid","useIdStore","useLogSizeStore","TicTacToe","fillSquare","player","crossesPlayer","noughtsPlayer","Error","board","position","splice","startGame","crossesConnId","noughtsConnId","Array","fill","Tile","styled","div","Board","Host","React","createElement","Fragment","Link","to","location","host","value","Button","button","TileOrButton","onClick","compendium","name","Guest","permutations","useConnectionId","setConnectionId","randomWords","exactly","join","getGame","compendiumIndex","words","split","sortedWords","sort","permutation","word","w","permu","isEqual","decodeCompendiumIndex","useGame","setGame","NewGame","onNewGame","set","onSubmit","onChange","preventDefault","onKeyPress","JoinGame","onJoinGame","Home","push","useHistory","order","createRoomId","HostRoute","useParams","GuestRoute","Router","path","exact","App","reportWebVitals","onPerfEntry","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","webpackEmptyContext","req","code","resolve","module","exports"],"mappings":"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","file":"static/js/main.9ed45d71.chunk.js","sourcesContent":["const getMoves = ({ connectionId, roomId, game }) => (\n  connectionId === roomId ? game.hostMoves : game.guestMoves\n);\n\nconst getMoveFunction = ({ connectionId, roomId, game, move }) => (\n  getMoves({ connectionId, roomId, game })[move]\n)\n\nexport const constructReducer = ({ game, events, roomId }) => (state) => {\n  try {\n    return events.reduce(\n      (o, event) => {\n        const moveFn = getMoveFunction({ connectionId: event.connectionId, roomId, game, move: event.move })\n        return moveFn({ state: o, connectionId: event.connectionId, args: event.args });\n      },\n      state\n    );\n  } catch (e) {\n    console.error(e);\n    return state;\n  }\n}\n\nexport const constructMoves = ({ game, connectionId, roomId, handleMove }) => {\n  return new Proxy({}, {\n    get: (target, key, receiver) => {\n      const moves = getMoves({ connectionId, roomId, game });\n      if (moves.hasOwnProperty(key)) {\n        return (args) => handleMove({ move: key, args });\n      } else if (key === Symbol.iterator && moves) {\n        return moves.keys().bind(target)[Symbol.iterator]\n      } else {\n        return Reflect.get(target, key, receiver);\n      }\n    }\n  });\n}\n","import { useState, useEffect } from \"react\";\n\nconst usePersist = (store, key, defaultValue) => {\n  const [state, setState] = useState(\n    () => (\n      JSON.parse(store.getItem(key)) || \n      ((defaultValue instanceof Function) ? defaultValue() : defaultValue)\n    )\n  );\n\n  const [storedValue, setStoredValue] = useState(() => {\n    try {\n      const item = window.localStorage.getItem(key);\n      return item ? JSON.parse(item) : defaultValue;\n    } catch (error) {\n      console.error(error);\n      return defaultValue;\n    }\n  });\n\n  useEffect(() => {\n    store.setItem(key, JSON.stringify(state));\n  }, [key, state]);\n\n  return [state, setState];\n}\n\nexport default usePersist;\n","import { useRef, useEffect } from \"react\";\nimport { useStateStore } from \"./stores\";\nimport { constructReducer } from \"../shared\";\n\nconst updateState = ({ roomId, setState, game, events }) => {\n  const reducer = constructReducer({ game, roomId, events })\n  setState(reducer);\n}\n\nconst useGameState = ({ roomId, game, eventLog }) => {\n  const logSize = useRef();\n  const { state, setState } = useStateStore(roomId);\n  useEffect(() => {\n    const events = eventLog.slice(logSize.current || 0);\n    if (!roomId || !game || !events.length) return;\n    updateState({ roomId, setState, game, events });\n    logSize.current = eventLog.length;\n  }, [setState, roomId, game, eventLog, logSize])\n  return { state };\n}\n\nexport default useGameState\n","import usePersist from '../usePersist';\n\nexport const useStateStore = (roomId) => {\n  const [state, setState]  = usePersist(\n    window.localStorage,\n    `hostState-${roomId}`,\n    {}\n  );\n  return { state, setState }\n}\n\nexport const useEventLogStore = (roomId) => {\n  const [eventLog, setEventLog] = usePersist(\n    window.localStorage,\n    `eventLog-${roomId}`,\n    []\n  );\n  return { eventLog, setEventLog };\n}\n","export const logEvent = ({ setEventLog, event, connectionId }) => {\n  setEventLog(events => [...events, { ...event, connectionId }]);\n}\n\n","import { useEffect, useRef, useState, useReducer } from \"react\";\nimport Peer from \"peerjs\";\n\nconst destructPeer = ({ setPeer }) => {\n  setPeer(peer => {\n    peer && peer.destroy();\n    return null\n  })\n};\n\nconst usePeer = (id) => {\n  const [peer, setPeer] = useState();\n  const [open, setOpen] = useState(false);\n  const [attempts, countAttempt] = useReducer(a => a + 1, 0);\n\n  useEffect(() => {\n    if (open) return;\n\n    const peer = new Peer(id);\n    setPeer(peer);\n\n    const retry = () => {\n      setOpen(false);\n      destructPeer({ setPeer });\n      countAttempt();\n    };\n\n    let timeout = setTimeout(retry, 1000);\n\n    peer.on(\"open\", () => {\n      clearTimeout(timeout);\n      setOpen(true);\n    });\n\n    const onConnectionClosed = () => {\n      clearTimeout(timeout);\n      timeout = setTimeout(retry, 1000);\n    }\n    peer.on(\"close\", onConnectionClosed);\n    peer.on(\"disconnected\", onConnectionClosed);\n    peer.on(\"error\", onConnectionClosed);\n\n    return () => {\n      destructPeer({ setPeer });\n      clearTimeout(timeout);\n    }\n  }, [attempts, id])\n\n  return { open, peer }\n}\n\nexport default usePeer;\n","import { useRef, useState, useEffect, useMemo } from \"react\";\nimport { isString, isObject, isInteger } from \"lodash\";\nimport { logEvent } from \"./funcs\";\nimport usePeer from \"../usePeer\";\n\nconst validateEvent = (event, validMoves) => (\n  event &&\n  isString(event.move) && \n  isObject(event.args) &&\n  validMoves.findIndex((m) => m === event.move) > -1\n)\n\nconst appendConnection = ({ setConnections, conn }) => {\n  setConnections((conns) => [...conns, conn]);\n}\n\nconst removeConnection = ({ setConnections, conn }) => {\n  setConnections((conns) => conns.filter(c => c !== conn))\n}\n\nconst updateLogSizeMap = ({ conn, connectionLogSizeMap, size = 0 }) => {\n  connectionLogSizeMap.current[conn.peer] = size\n}\n\nconst useConnections = ({ game, roomId, eventLog, setEventLog }) => {\n  const { peer } = usePeer(roomId);\n  const [connections, setConnections] = useState([]);\n  const connectionLogSizeMap = useRef({});\n\n  useEffect(() => {\n    if (!peer) return;\n    peer.on(\"connection\", (conn) => {\n      conn.on(\"open\", () => {\n        appendConnection({ setConnections, conn });\n      });\n\n      conn.on(\"data\", ({ index, ...event }) => {\n        if (isInteger(index)) {\n          updateLogSizeMap({ conn, connectionLogSizeMap, size: index + 1 });\n        }\n        \n        if (\n          (isInteger(index) || index === null) &&\n          validateEvent(event, Object.keys(game.guestMoves))\n        ) {\n          logEvent({ setEventLog, event, connectionId: conn.peer });\n        }\n      })\n\n      conn.on(\"close\", () => {\n        removeConnection({ setConnections, conn });\n      });\n\n      conn.on(\"error\", (error) => {\n        console.error(conn.peer, error)\n      });\n    })\n\n  }, [peer, game, roomId])\n\n  return { connections, connectionLogSizeMap }\n}\n\nexport default useConnections;\n","import { useEffect, useState } from \"react\";\nimport { constructMoves } from \"../shared\";\nimport { logEvent } from \"./funcs\";\n\nconst constructMovesHandler = ({ setMoves, game, roomId, setEventLog }) => {\n  const handleMove = ({ move, args }) => {\n    logEvent({ setEventLog, event: { move, args }, connectionId: roomId })\n  };\n  setMoves(() => constructMoves({ game, connectionId: roomId, roomId, handleMove }))\n}\n\nconst useMoves = ({ roomId, game, setEventLog }) => {\n  const [moves, setMoves] = useState(null);\n\n  useEffect(() => {\n    if (!game) return;\n    constructMovesHandler({ setMoves, game, roomId, setEventLog });\n  }, [roomId, game, setEventLog]);\n\n  return { moves, setMoves }\n}\n\nexport default useMoves;\n","import { useEffect } from \"react\";\n\nconst useSendSyncs = ({ connections, connectionLogSizeMap, eventLog }) => {\n  useEffect(() => {\n    for (const connection of connections) {\n      const numSent = connectionLogSizeMap.current[connection.peer] || 0;\n      if (eventLog.length > numSent) {\n        const events = eventLog.slice(numSent)\n          .map((e, i) => ({ ...e, index: numSent + i }));\n        connection.send(events);\n      }\n    }\n  }, [connections, connectionLogSizeMap, eventLog]);\n};\n\nexport default useSendSyncs;\n","import { useRef, useState, useEffect, useMemo } from \"react\";\nimport { constructMoves, constructReducer } from \"../shared\";\nimport { useStateStore, useEventLogStore } from \"./stores\";\nimport useGameState from \"./useGameState\";\nimport useConnections from \"./useConnections\";\nimport useMoves from \"./useMoves\";\nimport useSendSyncs from \"./useSendSyncs\";\n\n\nconst usePartyHost = ({ roomId, game }) => {\n  const { eventLog, setEventLog } = useEventLogStore(roomId);\n  const { state } = useGameState({ roomId, game, eventLog });\n  const { connections, connectionLogSizeMap } = useConnections({ game, roomId, eventLog, setEventLog })\n  const connectionIds = useMemo(() => connections.map(({ peer }) => peer), [connections])\n  const { moves } = useMoves({ roomId, game, setEventLog });\n  useSendSyncs({ connections, connectionLogSizeMap, eventLog });\n  return { state, moves, connections: connectionIds }\n}\n\nexport default usePartyHost;\n","export const logSizeToIndex = logSize => {\n  const index = logSize - 1;\n  return (index < 0) ? null : index;\n};\n","import { useEffect } from \"react\";\nimport { logSizeToIndex } from \"./funcs\";\n\nexport const ack = ({ conn, logSize }) => {\n  conn.current.send({ index: logSizeToIndex(logSize) })\n}\n\nconst useAck = ({ connected, conn, logSize }) => {\n  useEffect(() => {\n    if (!conn.current || !connected) return;\n    ack({ conn, logSize })\n  }, [connected, conn.current, logSize]);\n}\n\nexport default useAck;\n","import { useEffect } from \"react\";\nimport { constructReducer } from \"../shared\";\n\nconst sync = ({ setState, setCache, roomId, game, events }) => {\n  const reducer = constructReducer({ game, roomId, events })\n  setState(({ state }) => {\n    const newState = reducer(state);\n    return { state: newState, cache: newState }\n  });\n}\n\nconst updateLogSize = ({ setLogSize, events }) => {\n  setLogSize(events[events.length - 1].index + 1);\n}\n\nconst useSync = ({ data, clearData, game, roomId, setState, setLogSize }) => {\n  useEffect(() => {\n    if (!data || !data.length) return;\n    const events = [...data]\n    clearData();\n    updateLogSize({ setLogSize, events });\n    sync({ setState, roomId, game, events })\n  }, [data, clearData, game, roomId, setLogSize, setState])\n}\n\nexport default useSync;\n","import { useEffect, useState } from \"react\";\nimport { constructMoves, constructReducer } from \"../shared\";\nimport { logSizeToIndex } from \"./funcs\";\n\nexport const emit = ({ conn, logSize, move, args }) => {\n  conn.current.send({ index: logSizeToIndex(logSize), move, args })\n}\n\nexport const preempt = ({ setState, game, move, args, connectionId, roomId }) => {\n  const reducer = constructReducer({ game, roomId, events: [{ move, args, connectionId }] })\n  setState(({ state, cache }) => ({\n    cache: reducer(state),\n    state,\n  }));\n}\n\nexport const constructMovesHandler = ({ conn, connectionId, setMoves, setState, game, logSize, roomId }) => {\n  const handleMove = ({ move, args }) => {\n    preempt({ setState, game, move, args, roomId, connectionId })\n    emit({ conn, move, args, logSize })\n  }\n  setMoves(() => constructMoves({ game, connectionId, roomId, handleMove }));\n}\n\nconst useMoves = ({ connected, conn, id, setState, roomId, game, logSize }) => {\n  const [moves, setMoves] = useState(null);\n  useEffect(() => {\n    if (!connected) return;\n    constructMovesHandler({ conn, connectionId: id, setMoves, setState, roomId, game, logSize })\n  }, [connected, conn.current, id, setMoves, setState, roomId, game, logSize])\n  return { moves };\n}\n\nexport default useMoves;\n","import { useEffect, useRef, useState, useReducer } from \"react\";\nimport usePeer from \"../usePeer\";\n\nexport const connect = ({ roomId, peer, conn }) => {\n  conn.current = peer.connect(roomId);\n}\n\nconst useConnection = ({ id, roomId }) => {\n  const conn = useRef();\n  const { open, peer } = usePeer(id);\n  const [data, setData] = useState([]);\n  const [connected, setConnected] = useState(false);\n  const [attempts, countAttempt] = useReducer(a => a + 1, 0);\n\n  useEffect(() => {\n    if (!open || connected) return;\n\n    connect({ conn, peer, roomId });\n\n    const retry = () => {\n      conn.current = null;\n      setConnected(false);\n      countAttempt();\n    }\n    const timeout = setTimeout(retry, 1000);\n\n    conn.current.on(\"open\", () => {\n      clearTimeout(timeout);\n      setConnected(true); \n    });\n\n    conn.current.on(\"data\", (data) => {\n      setData((stream) => [...stream, ...data]);\n    });\n\n    conn.current.on(\"close\", () => {\n      clearTimeout(timeout);\n      retry();\n    });\n\n    conn.current.on(\"error\", (error) => {\n      console.error(error)\n    });\n\n  }, [attempts, open, connected, roomId]);\n\n  const clearData = () => setData([]);\n  return { connected: open && connected, conn, data, clearData }\n}\n\nexport default useConnection;\n","import useAck from \"./useAck\";\nimport useSync from \"./useSync\";\nimport useMoves from \"./useMoves\";\nimport useConnection from \"./useConnection\";\nimport { useIdStore, useStateStore, useLogSizeStore } from \"./stores\";\n\nconst usePartyGuest = ({ roomId, game }) => {\n  const { id } = useIdStore(roomId);\n  const { cache, setState } = useStateStore(roomId);\n  const { logSize, setLogSize } = useLogSizeStore(roomId);\n  const { connected, conn, data, clearData } = useConnection({ id, roomId })\n  useAck({ connected, conn, logSize });\n  useSync({ data, clearData, game, roomId, setState, setLogSize });\n  const { moves } = useMoves({ connected, conn, id, setState, roomId, game, logSize });\n  return { connected, state: cache, moves }\n}\n\nexport default usePartyGuest;\n","import usePersist from \"../usePersist\";\nimport { v4 as uuid } from \"uuid\";\n\nexport const useIdStore = (roomId) => {\n  const [id] = usePersist(\n    window.localStorage,\n    `id-${roomId}`,\n    uuid,\n  );\n  return { id };\n}\n\nexport const useStateStore = (roomId) => {\n  const [{ cache }, setState] = usePersist(\n    window.localStorage,\n    `guestState-${roomId}`,\n    { state: {}, cache: {} }\n  );\n  return { cache, setState };\n}\n\nexport const useLogSizeStore = (roomId) => {\n  const [logSize, setLogSize] = usePersist(\n    window.localStorage,\n    `logSize-${roomId}`,\n    0\n  );\n  return { logSize, setLogSize };\n}\n","export const NOUGHTS = 1;\nexport const CROSSES = 2;\n\nconst startGame = ({ state, connectionId, args }) => ({\n  crossesPlayer: args.crossesConnId,\n  noughtsPlayer: args.noughtsConnId,\n  board: Array(9).fill(null),\n});\n\nconst fillSquare = ({ state, connectionId, args }) => {\n  let player = null\n  if (connectionId === state.crossesPlayer) {\n    player = CROSSES;\n  } else if (connectionId === state.noughtsPlayer) {\n    player = NOUGHTS;\n  } else {\n    throw new Error('Connection is not a player');\n  }\n\n  if (state.board[args.position] !== null) {\n    throw new Error('Position filled');\n  }\n\n  const board = [...state.board];\n  board.splice(args.position, 1, player);\n\n  return ({\n    ...state,\n    board,\n  })\n}\n\nconst TicTacToe = {\n  guestMoves: {\n    fillSquare,\n  },\n  \n  hostMoves: {\n    startGame,\n  },\n}\n\nexport default TicTacToe;\n","import React, { useEffect } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport { NOUGHTS, CROSSES } from \"@compendium/tic-tac-toe-game\";\nconst Tile = styled.div`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: cyan;\n  border: 2px solid yellow;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Board = styled.div`\n  width: 30em;\n  height: 30em;\n`;\n\nconst Host = ({\n  state,\n  roomId,\n  moves,\n  connections\n}) => {\n  useEffect(() => {\n    if (!state.board && connections.length >= 2) {\n      const [crossesConnId, noughtsConnId] = connections;\n      moves.startGame({\n        crossesConnId,\n        noughtsConnId\n      });\n    }\n  }, [connections]);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, connections.length < 2 && /*#__PURE__*/React.createElement(Link, {\n    to: `/guest/${roomId}`\n  }, window.location.host, \"#/guest/\", roomId), /*#__PURE__*/React.createElement(Board, null, state.board && state.board.map((value, position) => /*#__PURE__*/React.createElement(Tile, {\n    key: position\n  }, value === NOUGHTS ? \"O\" : null, value === CROSSES ? \"X\" : null))));\n};\n\nexport default Host;","import React from \"react\";\nimport styled from \"styled-components\";\nimport { NOUGHTS, CROSSES } from \"@compendium/tic-tac-toe-game\";\nconst Button = styled.button`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Tile = styled.div`\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n`;\nconst Board = styled.div`\n  width: 30em;\n  height: 30em;\n`;\n\nconst TileOrButton = ({\n  value,\n  onClick\n}) => value === null ? /*#__PURE__*/React.createElement(Button, {\n  onClick: onClick\n}) : /*#__PURE__*/React.createElement(Tile, null, value === NOUGHTS ? \"O\" : null, value === CROSSES ? \"X\" : null);\n\nconst Guest = ({\n  connected,\n  state,\n  moves\n}) => /*#__PURE__*/React.createElement(React.Fragment, null, connected ? null : /*#__PURE__*/React.createElement(\"p\", null, \"Disconnected..\"), /*#__PURE__*/React.createElement(Board, null, state.board && state.board.map((value, position) => /*#__PURE__*/React.createElement(TileOrButton, {\n  key: position,\n  value: value,\n  onClick: () => connected && moves.fillSquare({\n    position\n  })\n}))));\n\nexport default Guest;","import TicTacToe from \"@compendium/tic-tac-toe\";\n\nconst compendium = [\n  TicTacToe,\n];\n\nexport default compendium;\n","import game from \"@compendium/tic-tac-toe-game\";\nimport Host from \"@compendium/tic-tac-toe-host\";\nimport Guest from \"@compendium/tic-tac-toe-guest\";\n\nconst name = \"Tic Tac Toe\";\n\nexport default { name, Host, Guest, game };\n","import { useState, useEffect } from \"react\";\nimport compendium from \"@compendium/compendium\";\nimport randomWords from \"random-words\";\nimport isEqual from \"lodash/isEqual\";\n\nconst permutations = [\n  [0, 1, 2],\n  [0, 2, 1],\n  [1, 0, 2],\n  [2, 0, 1],\n  [2, 1, 0],\n  [1, 2, 0],\n];\n\nconst createConnectionId = () => randomWords({ exactly: 5 }).join('-');\n\nexport const useConnectionId = () => {\n  const [connectionId, setConnectionId] = useState();\n  useEffect(() => {\n    setConnectionId(() => createConnectionId())\n  }, []);\n  return connectionId;\n}\n\nexport const createRoomId = (compendiumIndex) => {\n  const order = permutations[compendiumIndex]\n  const words = randomWords({ exactly: 3 })\n  const sortedWords = words.sort()\n  const orderedWords = order.map(o => sortedWords[o])\n  const roomId = orderedWords.join('-')\n  return roomId\n}\n\nconst decodeCompendiumIndex = (roomId) => {\n  const words = roomId.split('-')\n  const sortedWords = words.sort()\n  const permutation = words.map(word => sortedWords.findIndex((w) => word === w))\n  const compendiumIndex = permutations.findIndex((permu) => isEqual(permu, permutation))\n  return compendiumIndex;\n}\n\nconst getGame = (roomId) => {\n  const compendiumIndex = decodeCompendiumIndex(roomId)\n  const game = compendium[compendiumIndex];\n  return game;\n}\n\nexport const useGame = (roomId) => {\n  const [game, setGame] = useState({ name: null, Host: null, Guest: null, game: null });\n  useEffect(() => setGame(getGame(roomId)), [])\n  return game;\n}\n","import { useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { createRoomId } from \"./rooms\";\nimport compendium from \"@compendium/compendium\";\n\nconst NewGame = ({ onNewGame }) => {\n  const [value, set] = useState(0);\n\n  const onChange = (e) => {\n    set(e.target.value);\n    e.preventDefault();\n  }\n\n  const onSubmit = () => onNewGame(value);\n\n  return (\n    <>\n      <select onChange={onChange} value={value}>\n        {compendium.map(({ name }, index) =>\n          <option value={index} key={index}>{name}</option>)}\n      </select>\n      <button onClick={onSubmit} onKeyPress={onSubmit}>Host New Game</button>\n    </>\n  )\n}\n\nconst JoinGame = ({ onJoinGame }) => {\n  const [value, set] = useState();\n\n  const onChange = (e) => {\n    set(e.target.value);\n    e.preventDefault();\n  }\n\n  const onSubmit = () => onJoinGame(value);\n\n  return (\n    <>\n      <label>\n        Room Password\n        <input onChange={onChange} value={value}/>\n      </label>\n      <button onClick={onSubmit} onKeyPress={onSubmit}>Join Game</button>\n    </>\n  );\n}\n\n\nconst Home = () => {\n  const { push } = useHistory();\n\n  const onNewGame = (compendiumIndex) => {\n    const roomId = createRoomId(compendiumIndex);\n    push(`/host/${roomId}`)\n  }\n\n  const onJoinGame = (roomId) => {\n    push(`/guest/${roomId}`)\n  }\n\n  return (\n    <>\n      <NewGame onNewGame={onNewGame} />\n      <JoinGame onJoinGame={onJoinGame} />\n    </>\n  )\n}\n\n\nexport default Home;\n","import { usePartyHost, usePartyGuest } from \"@compendium/peer-party\";\nimport { HashRouter, Switch, Route, useParams } from \"react-router-dom\";\nimport { useGame, useConnectionId } from \"./rooms\";\nimport Home from \"./Home\";\n\nconst HostRoute = () => {\n  const { roomId } = useParams();\n  const { Host, game } = useGame(roomId);\n  const { state, moves, connections } = usePartyHost({ roomId, game });\n  return (\n    Host && <Host roomId={roomId} state={state} moves={moves} connections={connections} />\n  )\n}\n\nconst GuestRoute = () => {\n  const id = useConnectionId();\n  const { roomId } = useParams();\n  const { Guest, game } = useGame(roomId);\n  const { connected, state, moves } = usePartyGuest({ id, roomId, game });\n  return (\n    Guest && <Guest connectionId={id} roomId={roomId} connected={connected} state={state} moves={moves}/>\n  )\n}\n\nconst Router = () =>\n  <HashRouter>\n    <Switch>\n      <Route path=\"/host/:roomId\">\n        <HostRoute/>\n      </Route>\n      <Route path=\"/guest/:roomId\">\n        <GuestRoute/>\n      </Route>\n      <Route exact path=\"/\">\n        <Home/>\n      </Route>\n    </Switch>\n  </HashRouter>\n\nexport default Router;\n","import Router from \"./Router\";\n\nconst App = () =>\n  <Router/>\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 62;"],"sourceRoot":""}