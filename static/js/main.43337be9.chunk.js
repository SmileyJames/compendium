(this["webpackJsonp@compendium/app"]=this["webpackJsonp@compendium/app"]||[]).push([[0],{148:function(e,n,t){"use strict";t.r(n);var o,c,r,a,i,u=t(0),s=t.n(u),d=t(53),m=t.n(d),l=t(30),f=t.n(l),g=function(e){var n=e.connectionId,t=e.roomId,o=e.game,c=e.move,r=b({connectionId:n,roomId:t,game:o,move:c});try{return r({})instanceof Function}catch(a){return!1}},v=function(e){var n=e.connectionId,t=e.roomId,o=e.game;return n===t?o.hostMoves:o.guestMoves},b=function(e){var n=e.connectionId,t=e.roomId,o=e.game,c=e.move;return v({connectionId:n,roomId:t,game:o})[c]},j=function(e){var n=e.game,t=e.events,o=e.roomId;return function(e){try{return t.reduce((function(e,t){var c=b({connectionId:t.connectionId,roomId:o,game:n,move:t.move})({state:e,connectionId:t.connectionId,args:t.args});c instanceof Function&&t.seed&&(c=c(f()(t.seed)));return c}),e)}catch(c){return console.error(c),e}}},O=function(e){var n=e.game,t=e.connectionId,o=e.roomId,c=e.handleMove;return new Proxy({},{get:function(e,r,a){var i=v({connectionId:t,roomId:o,game:n});return i.hasOwnProperty(r)?function(e){return c({move:r,args:e})}:r===Symbol.iterator&&i?i.keys().bind(e)[Symbol.iterator]:Reflect.get(e,r,a)}})},I=t(2),h=function(e,n,t){var o=Object(u.useState)((function(){return JSON.parse(e.getItem(n))||(t instanceof Function?t():t)})),c=Object(I.a)(o,2),r=c[0],a=c[1],i=Object(u.useState)((function(){try{var e=window.localStorage.getItem(n);return e?JSON.parse(e):t}catch(o){return console.error(o),t}})),s=Object(I.a)(i,2);s[0],s[1];return Object(u.useEffect)((function(){e.setItem(n,JSON.stringify(r))}),[n,r]),[r,a]},S=function(e){var n=e.roomId,t=e.game,o=e.eventLog,c=Object(u.useRef)(),r=function(e){var n=h(window.localStorage,"hostState-".concat(e),{}),t=Object(I.a)(n,2);return{state:t[0],setState:t[1]}}(n),a=r.state,i=r.setState;return Object(u.useEffect)((function(){var e=o.slice(c.current||0);n&&t&&e.length&&(!function(e){var n=e.roomId,t=e.setState,o=e.game,c=e.events;t(j({game:o,roomId:n,events:c}))}({roomId:n,setState:i,game:t,events:e}),c.current=o.length)}),[i,n,t,o,c]),{state:a}},p=t(60),x=t(5),E=t(23),w=t(10),L=function(e){return e()},z=function(e){var n=e.setEventLog,t=e.event,o=e.connectionId,c=e.roomId,r=e.game,a=e.random,i=g({connectionId:o,roomId:c,game:r,move:t.move})?Object(w.a)(Object(w.a)({},t),{},{connectionId:o,seed:L(a)}):Object(w.a)(Object(w.a)({},t),{},{connectionId:o});n((function(e){return[].concat(Object(x.a)(e),[i])}))},y=t(54),M=t.n(y),C=function(e){(0,e.setPeer)((function(e){return e&&e.destroy(),null}))},k={host:"peerjs.92k.de",secure:!0},P=function(e){var n=Object(u.useState)(),t=Object(I.a)(n,2),o=t[0],c=t[1],r=Object(u.useState)(!1),a=Object(I.a)(r,2),i=a[0],s=a[1],d=Object(u.useReducer)((function(e){return e+1}),0),m=Object(I.a)(d,2),l=m[0],f=m[1];return Object(u.useEffect)((function(){if(!i){var n=new M.a(e,k);c(n);var t=function(){s(!1),C({setPeer:c}),f()},o=setTimeout(t,1e3);n.on("open",(function(){clearTimeout(o),s(!0)}));var r=function(){clearTimeout(o),o=setTimeout(t,1e3)};return n.on("close",r),n.on("disconnected",r),n.on("error",r),function(){C({setPeer:c}),clearTimeout(o)}}}),[l,e]),{open:i,peer:o}},T=function(e){var n=e.game,t=e.roomId,o=(e.eventLog,e.setEventLog),c=e.random,r=P(t).peer,a=Object(u.useState)([]),i=Object(I.a)(a,2),s=i[0],d=i[1],m=Object(u.useRef)({});return Object(u.useEffect)((function(){r&&r.on("connection",(function(e){e.on("open",(function(){!function(e){var n=e.setConnections,t=e.conn;n((function(e){return[].concat(Object(x.a)(e),[t])}))}({setConnections:d,conn:e})})),e.on("data",(function(r){var a=r.index,i=Object(p.a)(r,["index"]);Object(E.isInteger)(a)&&function(e){var n=e.conn,t=e.connectionLogSizeMap,o=e.size,c=void 0===o?0:o;t.current[n.peer]=c}({conn:e,connectionLogSizeMap:m,size:a+1}),(Object(E.isInteger)(a)||null===a)&&function(e,n){return e&&Object(E.isString)(e.move)&&Object(E.isObject)(e.args)&&n.findIndex((function(n){return n===e.move}))>-1}(i,Object.keys(n.guestMoves))&&z({setEventLog:o,event:i,connectionId:e.peer,roomId:t,game:n,random:c})})),e.on("close",(function(){!function(e){var n=e.setConnections,t=e.conn;n((function(e){return e.filter((function(e){return e!==t}))}))}({setConnections:d,conn:e})})),e.on("error",(function(n){console.error(e.peer,n)}))}))}),[r,n,t]),{connections:s,connectionLogSizeMap:m}},F=function(e){var n=e.roomId,t=e.game,o=e.setEventLog,c=e.random,r=Object(u.useState)(null),a=Object(I.a)(r,2),i=a[0],s=a[1];return Object(u.useEffect)((function(){t&&function(e){var n=e.setMoves,t=e.game,o=e.roomId,c=e.setEventLog,r=e.random,a=function(e){var n=e.move,a=e.args;z({setEventLog:c,event:{move:n,args:a},connectionId:o,roomId:o,game:t,random:r})};n((function(){return O({game:t,connectionId:o,roomId:o,handleMove:a})}))}({setMoves:s,game:t,roomId:n,setEventLog:o,random:c})}),[n,t,o]),{moves:i,setMoves:s}},G=t(55),D=function(e){var n=e.connections,t=e.connectionLogSizeMap,o=e.eventLog;Object(u.useEffect)((function(){var e,c=Object(G.a)(n);try{var r=function(){var n=e.value,c=t.current[n.peer]||0;if(o.length>c){var r=o.slice(c).map((function(e,n){return Object(w.a)(Object(w.a)({},e),{},{index:c+n})}));n.send(r)}};for(c.s();!(e=c.n()).done;)r()}catch(a){c.e(a)}finally{c.f()}}),[n,t,o])},J=function(e){var n=e.roomId,t=e.game,o=e.secret,c=Object(u.useMemo)((function(){return f()(o||n)}),[o,n]),r=function(e){var n=h(window.localStorage,"eventLog-".concat(e),[]),t=Object(I.a)(n,2);return{eventLog:t[0],setEventLog:t[1]}}(n),a=r.eventLog,i=r.setEventLog,s=S({roomId:n,game:t,eventLog:a}).state,d=T({game:t,roomId:n,eventLog:a,setEventLog:i,random:c}),m=d.connections,l=d.connectionLogSizeMap,g=Object(u.useMemo)((function(){return m.map((function(e){return e.peer}))}),[m]),v=F({roomId:n,game:t,setEventLog:i,random:c}).moves;return D({connections:m,connectionLogSizeMap:l,eventLog:a}),{state:s,moves:v,connections:g}},N=function(e){var n=e-1;return n<0?null:n},R=function(e){var n=e.connected,t=e.conn,o=e.logSize;Object(u.useEffect)((function(){t.current&&n&&function(e){var n=e.conn,t=e.logSize;n.current.send({index:N(t)})}({conn:t,logSize:o})}),[n,t.current,o])},H=function(e){var n=e.data,t=e.clearData,o=e.game,c=e.roomId,r=e.setState,a=e.setLogSize;Object(u.useEffect)((function(){if(n&&n.length){var e=Object(x.a)(n);t(),function(e){var n=e.setLogSize,t=e.events;n(t[t.length-1].index+1)}({setLogSize:a,events:e}),function(e){var n=e.setState,t=(e.setCache,e.roomId),o=e.game,c=e.events,r=j({game:o,roomId:t,events:c});n((function(e){var n=e.state,t=r(n);return{state:t,cache:t}}))}({setState:r,roomId:c,game:o,events:e})}}),[n,t,o,c,a,r])},q=function(e){var n=e.conn,t=e.connectionId,o=e.setMoves,c=e.setState,r=e.game,a=e.logSize,i=e.roomId,u=function(e){var o=e.move,u=e.args;g({connectionId:t,roomId:i,game:r,move:o})||function(e){var n=e.setState,t=e.game,o=e.move,c=e.args,r=e.connectionId,a=e.roomId,i=j({game:t,roomId:a,events:[{move:o,args:c,connectionId:r}]});n((function(e){var n=e.state;return e.cache,{cache:i(n),state:n}}))}({setState:c,game:r,move:o,args:u,roomId:i,connectionId:t}),function(e){var n=e.conn,t=e.logSize,o=e.move,c=e.args;n.current.send({index:N(t),move:o,args:c})}({conn:n,move:o,args:u,logSize:a})};o((function(){return O({game:r,connectionId:t,roomId:i,handleMove:u})}))},B=function(e){var n=e.connected,t=e.conn,o=e.id,c=e.setState,r=e.roomId,a=e.game,i=e.logSize,s=Object(u.useState)(null),d=Object(I.a)(s,2),m=d[0],l=d[1];return Object(u.useEffect)((function(){n&&q({conn:t,connectionId:o,setMoves:l,setState:c,roomId:r,game:a,logSize:i})}),[n,t.current,o,l,c,r,a,i]),{moves:m}},K=function(e){var n=e.id,t=e.roomId,o=Object(u.useRef)(),c=P(n),r=c.open,a=c.peer,i=Object(u.useState)([]),s=Object(I.a)(i,2),d=s[0],m=s[1],l=Object(u.useState)(!1),f=Object(I.a)(l,2),g=f[0],v=f[1],b=Object(u.useReducer)((function(e){return e+1}),0),j=Object(I.a)(b,2),O=j[0],h=j[1];Object(u.useEffect)((function(){if(r&&!g){!function(e){var n=e.roomId,t=e.peer;e.conn.current=t.connect(n)}({conn:o,peer:a,roomId:t});var e=function(){o.current=null,v(!1),h()},n=setTimeout(e,1e3);o.current.on("open",(function(){clearTimeout(n),v(!0)})),o.current.on("data",(function(e){m((function(n){return[].concat(Object(x.a)(n),Object(x.a)(e))}))})),o.current.on("close",(function(){clearTimeout(n),e()})),o.current.on("error",(function(e){console.error(e)}))}}),[O,r,g,t]);return{connected:r&&g,conn:o,data:d,clearData:function(){return m([])}}},U=t(150),X=function(e){var n=e.roomId,t=e.game,o=function(e){var n=h(window.localStorage,"id-".concat(e),U.a);return{id:Object(I.a)(n,1)[0]}}(n).id,c=function(e){var n=h(window.localStorage,"guestState-".concat(e),{state:{},cache:{}}),t=Object(I.a)(n,2);return{cache:t[0].cache,setState:t[1]}}(n),r=c.cache,a=c.setState,i=function(e){var n=h(window.localStorage,"logSize-".concat(e),0),t=Object(I.a)(n,2);return{logSize:t[0],setLogSize:t[1]}}(n),u=i.logSize,s=i.setLogSize,d=K({id:o,roomId:n}),m=d.connected,l=d.conn,f=d.data,g=d.clearData;return R({connected:m,conn:l,logSize:u}),H({data:f,clearData:g,game:t,roomId:n,setState:a,setLogSize:s}),{connected:m,state:r,moves:B({connected:m,conn:l,id:o,setState:a,roomId:n,game:t,logSize:u}).moves}},_=t(3),A=t(19),Q={guestMoves:{fillSquare:function(e){var n=e.state,t=e.connectionId,o=e.args,c=null;if(t===n.crossesPlayer)c=2;else{if(t!==n.noughtsPlayer)throw new Error("Connection is not a player");c=1}if(null!==n.board[o.position])throw new Error("Position filled");var r=Object(x.a)(n.board);return r.splice(o.position,1,c),Object(w.a)(Object(w.a)({},n),{},{board:r})}},hostMoves:{startGame:function(e){e.state,e.connectionId;var n=e.args;return{crossesPlayer:n.crossesConnId,noughtsPlayer:n.noughtsConnId,board:Array(9).fill(null)}}}},V=t(13),W=t(14),Y=W.a.div(o||(o=Object(V.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: cyan;\n  border: 2px solid yellow;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),Z=W.a.div(c||(c=Object(V.a)(["\n  width: 30em;\n  height: 30em;\n"]))),$=function(e){var n=e.state,t=e.roomId,o=e.moves,c=e.connections;return Object(u.useEffect)((function(){if(!n.board&&c.length>=2){var e=Object(I.a)(c,2),t=e[0],r=e[1];o.startGame({crossesConnId:t,noughtsConnId:r})}}),[c]),s.a.createElement(s.a.Fragment,null,c.length<2&&s.a.createElement(A.b,{to:"/guest/".concat(t)},window.location.host,"#/guest/",t),s.a.createElement(Z,null,n.board&&n.board.map((function(e,n){return s.a.createElement(Y,{key:n},1===e?"O":null,2===e?"X":null)}))))},ee=W.a.button(r||(r=Object(V.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),ne=W.a.div(a||(a=Object(V.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),te=W.a.div(i||(i=Object(V.a)(["\n  width: 30em;\n  height: 30em;\n"]))),oe=function(e){var n=e.value,t=e.onClick;return null===n?s.a.createElement(ee,{onClick:t}):s.a.createElement(ne,null,1===n?"O":null,2===n?"X":null)},ce=[{name:"Tic Tac Toe",Host:$,Guest:function(e){var n=e.connected,t=e.state,o=e.moves;return s.a.createElement(s.a.Fragment,null,n?null:s.a.createElement("p",null,"Disconnected.."),s.a.createElement(te,null,t.board&&t.board.map((function(e,t){return s.a.createElement(oe,{key:t,value:e,onClick:function(){return n&&o.fillSquare({position:t})}})}))))},game:Q}],re=t(31),ae=t.n(re),ie=t(59),ue=t.n(ie),se=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[2,1,0],[1,2,0]],de=function(e){var n=function(e){var n=e.split("-"),t=Object(x.a)(n).sort(),o=n.map((function(e){return t.findIndex((function(n){return e===n}))}));return se.findIndex((function(e){return ue()(e,o)}))}(e);return ce[n]},me=function(e){var n=Object(u.useState)({name:null,Host:null,Guest:null,game:null}),t=Object(I.a)(n,2),o=t[0],c=t[1];return Object(u.useEffect)((function(){return c(de(e))}),[]),o},le=function(){var e=Object(u.useState)(),n=Object(I.a)(e,2),t=n[0],o=n[1];return Object(u.useEffect)((function(){o((function(){return ae()({exactly:5}).join("-")}))}),[]),t},fe=t(1),ge=function(e){var n=e.onNewGame,t=Object(u.useState)(0),o=Object(I.a)(t,2),c=o[0],r=o[1],a=function(){return n(c)};return Object(fe.jsxs)(fe.Fragment,{children:[Object(fe.jsx)("select",{onChange:function(e){r(e.target.value),e.preventDefault()},value:c,children:ce.map((function(e,n){var t=e.name;return Object(fe.jsx)("option",{value:n,children:t},n)}))}),Object(fe.jsx)("button",{onClick:a,onKeyPress:a,children:"Host New Game"})]})},ve=function(e){var n=e.onJoinGame,t=Object(u.useState)(),o=Object(I.a)(t,2),c=o[0],r=o[1],a=function(){return n(c)};return Object(fe.jsxs)(fe.Fragment,{children:[Object(fe.jsxs)("label",{children:["Room Password",Object(fe.jsx)("input",{onChange:function(e){r(e.target.value),e.preventDefault()},value:c})]}),Object(fe.jsx)("button",{onClick:a,onKeyPress:a,children:"Join Game"})]})},be=function(){var e=Object(_.f)().push;return Object(fe.jsxs)(fe.Fragment,{children:[Object(fe.jsx)(ge,{onNewGame:function(n){var t=function(e){var n=se[e],t=ae()({exactly:3}).sort();return n.map((function(e){return t[e]})).join("-")}(n);e("/host/".concat(t))}}),Object(fe.jsx)(ve,{onJoinGame:function(n){e("/guest/".concat(n))}})]})},je=function(){var e=Object(_.g)().roomId,n=me(e),t=n.Host,o=n.game,c=J({roomId:e,game:o}),r=c.state,a=c.moves,i=c.connections;return t&&Object(fe.jsx)(t,{roomId:e,state:r,moves:a,connections:i})},Oe=function(){var e=le(),n=Object(_.g)().roomId,t=me(n),o=t.Guest,c=t.game,r=X({id:e,roomId:n,game:c}),a=r.connected,i=r.state,u=r.moves;return o&&Object(fe.jsx)(o,{connectionId:e,roomId:n,connected:a,state:i,moves:u})},Ie=function(){return Object(fe.jsx)(A.a,{children:Object(fe.jsxs)(_.c,{children:[Object(fe.jsx)(_.a,{path:"/host/:roomId",children:Object(fe.jsx)(je,{})}),Object(fe.jsx)(_.a,{path:"/guest/:roomId",children:Object(fe.jsx)(Oe,{})}),Object(fe.jsx)(_.a,{exact:!0,path:"/",children:Object(fe.jsx)(be,{})})]})})},he=function(){return Object(fe.jsx)(Ie,{})},Se=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,151)).then((function(n){var t=n.getCLS,o=n.getFID,c=n.getFCP,r=n.getLCP,a=n.getTTFB;t(e),o(e),c(e),r(e),a(e)}))};m.a.render(Object(fe.jsx)(s.a.StrictMode,{children:Object(fe.jsx)(he,{})}),document.getElementById("root")),Se()},72:function(e,n){},73:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=73}},[[148,1,2]]]);
//# sourceMappingURL=main.43337be9.chunk.js.map