(this["webpackJsonp@compendium/app"]=this["webpackJsonp@compendium/app"]||[]).push([[0],{137:function(e,n,t){"use strict";t.r(n);var o,c,r,a,i,u=t(0),s=t.n(u),l=t(50),d=t.n(l),f=function(e){var n=e.connectionId,t=e.roomId,o=e.game;return n===t?o.hostMoves:o.guestMoves},m=function(e){var n=e.game,t=e.events,o=e.roomId;return function(e){try{return t.reduce((function(e,t){return function(e){var n=e.connectionId,t=e.roomId,o=e.game,c=e.move;return f({connectionId:n,roomId:t,game:o})[c]}({connectionId:t.connectionId,roomId:o,game:n,move:t.move})({state:e,connectionId:t.connectionId,args:t.args})}),e)}catch(c){return console.error(c),e}}},g=function(e){var n=e.game,t=e.connectionId,o=e.roomId,c=e.handleMove;return new Proxy({},{get:function(e,r,a){var i=f({connectionId:t,roomId:o,game:n});return i.hasOwnProperty(r)?function(e){return c({move:r,args:e})}:r===Symbol.iterator&&i?i.keys().bind(e)[Symbol.iterator]:Reflect.get(e,r,a)}})},v=t(2),b=function(e,n,t){var o=Object(u.useState)((function(){return JSON.parse(e.getItem(n))||(t instanceof Function?t():t)})),c=Object(v.a)(o,2),r=c[0],a=c[1],i=Object(u.useState)((function(){try{var e=window.localStorage.getItem(n);return e?JSON.parse(e):t}catch(o){return console.error(o),t}})),s=Object(v.a)(i,2);s[0],s[1];return Object(u.useEffect)((function(){e.setItem(n,JSON.stringify(r))}),[n,r]),[r,a]},j=function(e){var n=e.roomId,t=e.game,o=e.eventLog,c=Object(u.useRef)(),r=function(e){var n=b(window.localStorage,"hostState-".concat(e),{}),t=Object(v.a)(n,2);return{state:t[0],setState:t[1]}}(n),a=r.state,i=r.setState;return Object(u.useEffect)((function(){var e=o.slice(c.current||0);n&&t&&e.length&&(!function(e){var n=e.roomId,t=e.setState,o=e.game,c=e.events;t(m({game:o,roomId:n,events:c}))}({roomId:n,setState:i,game:t,events:e}),c.current=o.length)}),[i,n,t,o,c]),{state:a}},O=t(57),I=t(8),h=t(20),S=t(10),p=function(e){var n=e.setEventLog,t=e.event,o=e.connectionId;n((function(e){return[].concat(Object(I.a)(e),[Object(S.a)(Object(S.a)({},t),{},{connectionId:o})])}))},x=t(51),E=t.n(x),w=function(e){(0,e.setPeer)((function(e){return e&&e.destroy(),null}))},L=function(e){var n=Object(u.useState)(),t=Object(v.a)(n,2),o=t[0],c=t[1],r=Object(u.useState)(!1),a=Object(v.a)(r,2),i=a[0],s=a[1],l=Object(u.useReducer)((function(e){return e+1}),0),d=Object(v.a)(l,2),f=d[0],m=d[1];return Object(u.useEffect)((function(){if(!i){var n=new E.a(e);c(n);var t=function(){s(!1),w({setPeer:c}),m()},o=setTimeout(t,1e3);n.on("open",(function(){clearTimeout(o),s(!0)}));var r=function(){clearTimeout(o),o=setTimeout(t,1e3)};return n.on("close",r),n.on("disconnected",r),n.on("error",r),function(){w({setPeer:c}),clearTimeout(o)}}}),[f,e]),{open:i,peer:o}},z=function(e){var n=e.game,t=e.roomId,o=(e.eventLog,e.setEventLog),c=L(t).peer,r=Object(u.useState)([]),a=Object(v.a)(r,2),i=a[0],s=a[1],l=Object(u.useRef)({});return Object(u.useEffect)((function(){c&&c.on("connection",(function(e){e.on("open",(function(){!function(e){var n=e.setConnections,t=e.conn;n((function(e){return[].concat(Object(I.a)(e),[t])}))}({setConnections:s,conn:e})})),e.on("data",(function(t){var c=t.index,r=Object(O.a)(t,["index"]);Object(h.isInteger)(c)&&function(e){var n=e.conn,t=e.connectionLogSizeMap,o=e.size,c=void 0===o?0:o;t.current[n.peer]=c}({conn:e,connectionLogSizeMap:l,size:c+1}),(Object(h.isInteger)(c)||null===c)&&function(e,n){return e&&Object(h.isString)(e.move)&&Object(h.isObject)(e.args)&&n.findIndex((function(n){return n===e.move}))>-1}(r,Object.keys(n.guestMoves))&&p({setEventLog:o,event:r,connectionId:e.peer})})),e.on("close",(function(){!function(e){var n=e.setConnections,t=e.conn;n((function(e){return e.filter((function(e){return e!==t}))}))}({setConnections:s,conn:e})})),e.on("error",(function(n){console.error(e.peer,n)}))}))}),[c,n,t]),{connections:i,connectionLogSizeMap:l}},y=function(e){var n=e.roomId,t=e.game,o=e.setEventLog,c=Object(u.useState)(null),r=Object(v.a)(c,2),a=r[0],i=r[1];return Object(u.useEffect)((function(){t&&function(e){var n=e.setMoves,t=e.game,o=e.roomId,c=e.setEventLog,r=function(e){var n=e.move,t=e.args;p({setEventLog:c,event:{move:n,args:t},connectionId:o})};n((function(){return g({game:t,connectionId:o,roomId:o,handleMove:r})}))}({setMoves:i,game:t,roomId:n,setEventLog:o})}),[n,t,o]),{moves:a,setMoves:i}},M=t(52),C=function(e){var n=e.connections,t=e.connectionLogSizeMap,o=e.eventLog;Object(u.useEffect)((function(){var e,c=Object(M.a)(n);try{var r=function(){var n=e.value,c=t.current[n.peer]||0;if(o.length>c){var r=o.slice(c).map((function(e,n){return Object(S.a)(Object(S.a)({},e),{},{index:c+n})}));n.send(r)}};for(c.s();!(e=c.n()).done;)r()}catch(a){c.e(a)}finally{c.f()}}),[n,t,o])},k=function(e){var n=e.roomId,t=e.game,o=function(e){var n=b(window.localStorage,"eventLog-".concat(e),[]),t=Object(v.a)(n,2);return{eventLog:t[0],setEventLog:t[1]}}(n),c=o.eventLog,r=o.setEventLog,a=j({roomId:n,game:t,eventLog:c}).state,i=z({game:t,roomId:n,eventLog:c,setEventLog:r}),s=i.connections,l=i.connectionLogSizeMap,d=Object(u.useMemo)((function(){return s.map((function(e){return e.peer}))}),[s]),f=y({roomId:n,game:t,setEventLog:r}).moves;return C({connections:s,connectionLogSizeMap:l,eventLog:c}),{state:a,moves:f,connections:d}},P=function(e){var n=e-1;return n<0?null:n},T=function(e){var n=e.connected,t=e.conn,o=e.logSize;Object(u.useEffect)((function(){t.current&&n&&function(e){var n=e.conn,t=e.logSize;n.current.send({index:P(t)})}({conn:t,logSize:o})}),[n,t.current,o])},F=function(e){var n=e.data,t=e.clearData,o=e.game,c=e.roomId,r=e.setState,a=e.setLogSize;Object(u.useEffect)((function(){if(n&&n.length){var e=Object(I.a)(n);t(),function(e){var n=e.setLogSize,t=e.events;n(t[t.length-1].index+1)}({setLogSize:a,events:e}),function(e){var n=e.setState,t=(e.setCache,e.roomId),o=e.game,c=e.events,r=m({game:o,roomId:t,events:c});n((function(e){var n=e.state,t=r(n);return{state:t,cache:t}}))}({setState:r,roomId:c,game:o,events:e})}}),[n,t,o,c,a,r])},G=function(e){var n=e.conn,t=e.connectionId,o=e.setMoves,c=e.setState,r=e.game,a=e.logSize,i=e.roomId,u=function(e){var o=e.move,u=e.args;!function(e){var n=e.setState,t=e.game,o=e.move,c=e.args,r=e.connectionId,a=e.roomId,i=m({game:t,roomId:a,events:[{move:o,args:c,connectionId:r}]});n((function(e){var n=e.state;return e.cache,{cache:i(n),state:n}}))}({setState:c,game:r,move:o,args:u,roomId:i,connectionId:t}),function(e){var n=e.conn,t=e.logSize,o=e.move,c=e.args;n.current.send({index:P(t),move:o,args:c})}({conn:n,move:o,args:u,logSize:a})};o((function(){return g({game:r,connectionId:t,roomId:i,handleMove:u})}))},D=function(e){var n=e.connected,t=e.conn,o=e.id,c=e.setState,r=e.roomId,a=e.game,i=e.logSize,s=Object(u.useState)(null),l=Object(v.a)(s,2),d=l[0],f=l[1];return Object(u.useEffect)((function(){n&&G({conn:t,connectionId:o,setMoves:f,setState:c,roomId:r,game:a,logSize:i})}),[n,t.current,o,f,c,r,a,i]),{moves:d}},J=function(e){var n=e.id,t=e.roomId,o=Object(u.useRef)(),c=L(n),r=c.open,a=c.peer,i=Object(u.useState)([]),s=Object(v.a)(i,2),l=s[0],d=s[1],f=Object(u.useState)(!1),m=Object(v.a)(f,2),g=m[0],b=m[1],j=Object(u.useReducer)((function(e){return e+1}),0),O=Object(v.a)(j,2),h=O[0],S=O[1];Object(u.useEffect)((function(){if(r&&!g){!function(e){var n=e.roomId,t=e.peer;e.conn.current=t.connect(n)}({conn:o,peer:a,roomId:t});var e=function(){o.current=null,b(!1),S()},n=setTimeout(e,1e3);o.current.on("open",(function(){clearTimeout(n),b(!0)})),o.current.on("data",(function(e){d((function(n){return[].concat(Object(I.a)(n),Object(I.a)(e))}))})),o.current.on("close",(function(){clearTimeout(n),e()})),o.current.on("error",(function(e){console.error(e)}))}}),[h,r,g,t]);return{connected:r&&g,conn:o,data:l,clearData:function(){return d([])}}},N=t(139),R=function(e){var n=e.roomId,t=e.game,o=function(e){var n=b(window.localStorage,"id-".concat(e),N.a);return{id:Object(v.a)(n,1)[0]}}(n).id,c=function(e){var n=b(window.localStorage,"guestState-".concat(e),{state:{},cache:{}}),t=Object(v.a)(n,2);return{cache:t[0].cache,setState:t[1]}}(n),r=c.cache,a=c.setState,i=function(e){var n=b(window.localStorage,"logSize-".concat(e),0),t=Object(v.a)(n,2);return{logSize:t[0],setLogSize:t[1]}}(n),u=i.logSize,s=i.setLogSize,l=J({id:o,roomId:n}),d=l.connected,f=l.conn,m=l.data,g=l.clearData;return T({connected:d,conn:f,logSize:u}),F({data:m,clearData:g,game:t,roomId:n,setState:a,setLogSize:s}),{connected:d,state:r,moves:D({connected:d,conn:f,id:o,setState:a,roomId:n,game:t,logSize:u}).moves}},H=t(3),q=t(16),B={guestMoves:{fillSquare:function(e){var n=e.state,t=e.connectionId,o=e.args,c=null;if(t===n.crossesPlayer)c=2;else{if(t!==n.noughtsPlayer)throw new Error("Connection is not a player");c=1}if(null!==n.board[o.position])throw new Error("Position filled");var r=Object(I.a)(n.board);return r.splice(o.position,1,c),Object(S.a)(Object(S.a)({},n),{},{board:r})}},hostMoves:{startGame:function(e){e.state,e.connectionId;var n=e.args;return{crossesPlayer:n.crossesConnId,noughtsPlayer:n.noughtsConnId,board:Array(9).fill(null)}}}},K=t(11),U=t(12),X=U.a.div(o||(o=Object(K.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: cyan;\n  border: 2px solid yellow;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),_=U.a.div(c||(c=Object(K.a)(["\n  width: 30em;\n  height: 30em;\n"]))),A=function(e){var n=e.state,t=e.roomId,o=e.moves,c=e.connections;return Object(u.useEffect)((function(){if(!n.board&&c.length>=2){var e=Object(v.a)(c,2),t=e[0],r=e[1];o.startGame({crossesConnId:t,noughtsConnId:r})}}),[c]),s.a.createElement(s.a.Fragment,null,c.length<2&&s.a.createElement(q.b,{to:"/guest/".concat(t)},window.location.host,"#/guest/",t),s.a.createElement(_,null,n.board&&n.board.map((function(e,n){return s.a.createElement(X,{key:n},1===e?"O":null,2===e?"X":null)}))))},Q=U.a.button(r||(r=Object(K.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),V=U.a.div(a||(a=Object(K.a)(["\n  width: 33.333%;\n  height: 33.333%;\n  background-color: white;\n  border: 2px solid red;\n  color: black;\n  text-align: center;\n  float: left;\n  box-sizing: border-box;\n"]))),W=U.a.div(i||(i=Object(K.a)(["\n  width: 30em;\n  height: 30em;\n"]))),Y=function(e){var n=e.value,t=e.onClick;return null===n?s.a.createElement(Q,{onClick:t}):s.a.createElement(V,null,1===n?"O":null,2===n?"X":null)},Z=[{name:"Tic Tac Toe",Host:A,Guest:function(e){var n=e.connected,t=e.state,o=e.moves;return s.a.createElement(s.a.Fragment,null,n?null:s.a.createElement("p",null,"Disconnected.."),s.a.createElement(W,null,t.board&&t.board.map((function(e,t){return s.a.createElement(Y,{key:t,value:e,onClick:function(){return n&&o.fillSquare({position:t})}})}))))},game:B}],$=t(37),ee=t.n($),ne=t(56),te=t.n(ne),oe=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[2,1,0],[1,2,0]],ce=function(){var e=Object(u.useState)(),n=Object(v.a)(e,2),t=n[0],o=n[1];return Object(u.useEffect)((function(){o((function(){return ee()({exactly:5}).join("-")}))}),[]),t},re=function(e){var n=function(e){var n=e.split("-"),t=n.sort(),o=n.map((function(e){return t.findIndex((function(n){return e===n}))}));return oe.findIndex((function(e){return te()(e,o)}))}(e);return Z[n]},ae=function(e){var n=Object(u.useState)({name:null,Host:null,Guest:null,game:null}),t=Object(v.a)(n,2),o=t[0],c=t[1];return Object(u.useEffect)((function(){return c(re(e))}),[]),o},ie=t(1),ue=function(e){var n=e.onNewGame,t=Object(u.useState)(0),o=Object(v.a)(t,2),c=o[0],r=o[1],a=function(){return n(c)};return Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsx)("select",{onChange:function(e){r(e.target.value),e.preventDefault()},value:c,children:Z.map((function(e,n){var t=e.name;return Object(ie.jsx)("option",{value:n,children:t},n)}))}),Object(ie.jsx)("button",{onClick:a,onKeyPress:a,children:"Host New Game"})]})},se=function(e){var n=e.onJoinGame,t=Object(u.useState)(),o=Object(v.a)(t,2),c=o[0],r=o[1],a=function(){return n(c)};return Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsxs)("label",{children:["Room Password",Object(ie.jsx)("input",{onChange:function(e){r(e.target.value),e.preventDefault()},value:c})]}),Object(ie.jsx)("button",{onClick:a,onKeyPress:a,children:"Join Game"})]})},le=function(){var e=Object(H.f)().push;return Object(ie.jsxs)(ie.Fragment,{children:[Object(ie.jsx)(ue,{onNewGame:function(n){var t=function(e){var n=oe[e],t=ee()({exactly:3}).sort();return n.map((function(e){return t[e]})).join("-")}(n);e("/host/".concat(t))}}),Object(ie.jsx)(se,{onJoinGame:function(n){e("/guest/".concat(n))}})]})},de=function(){var e=Object(H.g)().roomId,n=ae(e),t=n.Host,o=n.game,c=k({roomId:e,game:o}),r=c.state,a=c.moves,i=c.connections;return t&&Object(ie.jsx)(t,{roomId:e,state:r,moves:a,connections:i})},fe=function(){var e=ce(),n=Object(H.g)().roomId,t=ae(n),o=t.Guest,c=t.game,r=R({id:e,roomId:n,game:c}),a=r.connected,i=r.state,u=r.moves;return o&&Object(ie.jsx)(o,{connectionId:e,roomId:n,connected:a,state:i,moves:u})},me=function(){return Object(ie.jsx)(q.a,{children:Object(ie.jsxs)(H.c,{children:[Object(ie.jsx)(H.a,{path:"/host/:roomId",children:Object(ie.jsx)(de,{})}),Object(ie.jsx)(H.a,{path:"/guest/:roomId",children:Object(ie.jsx)(fe,{})}),Object(ie.jsx)(H.a,{exact:!0,path:"/",children:Object(ie.jsx)(le,{})})]})})},ge=function(){return Object(ie.jsx)(me,{})},ve=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,140)).then((function(n){var t=n.getCLS,o=n.getFID,c=n.getFCP,r=n.getLCP,a=n.getTTFB;t(e),o(e),c(e),r(e),a(e)}))};d.a.render(Object(ie.jsx)(s.a.StrictMode,{children:Object(ie.jsx)(ge,{})}),document.getElementById("root")),ve()},62:function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=62}},[[137,1,2]]]);
//# sourceMappingURL=main.a236d158.chunk.js.map